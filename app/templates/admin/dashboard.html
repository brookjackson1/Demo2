{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Admin Dashboard</h1>
        <div class="flex space-x-4">
            <button id="simulate-results-btn" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                Simulate Results (Demo)
            </button>
            <a href="{{ url_for('fantasy_sports.index') }}" class="text-blue-600 hover:text-blue-800">
                ‚Üê Back to App
            </a>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <span class="text-blue-600 font-bold">{{ pending_slips|length }}</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Pending Slips</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ pending_slips|length }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                        <span class="text-green-600 font-bold">$</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Potential Payouts</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        ${{ "%.2f"|format(pending_slips|sum(attribute="potential_payout") or 0) }}
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                        <span class="text-yellow-600 font-bold">‚ö°</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Upcoming Games</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ recent_games|length }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                        <span class="text-purple-600 font-bold">üìä</span>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Entry Fees</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        ${{ "%.2f"|format(pending_slips|sum(attribute="entry_fee") or 0) }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <a href="{{ url_for('admin.manage_props') }}" class="block">
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üéØ</span>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold">Manage Props</h3>
                        <p class="text-gray-600">View and settle player props</p>
                    </div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('admin.manage_slips') }}" class="block">
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üìã</span>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold">Pick Slips</h3>
                        <p class="text-gray-600">View user pick slips</p>
                    </div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('admin.manage_games') }}" class="block">
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üèüÔ∏è</span>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold">Games</h3>
                        <p class="text-gray-600">Manage game status</p>
                    </div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('admin.manage_users') }}" class="block">
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üë•</span>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold">Users</h3>
                        <p class="text-gray-600">User management</p>
                    </div>
                </div>
            </div>
        </a>

        <a href="{{ url_for('admin.reports') }}" class="block">
            <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl">üìà</span>
                    </div>
                    <div class="ml-4">
                        <h3 class="text-lg font-semibold">Reports</h3>
                        <p class="text-gray-600">Analytics and reports</p>
                    </div>
                </div>
            </div>
        </a>
    </div>

    <!-- Recent Pending Slips -->
    <div class="bg-white rounded-lg shadow-md">
        <div class="p-6 border-b">
            <h2 class="text-xl font-semibold">Recent Pending Slips</h2>
        </div>
        <div class="overflow-x-auto">
            {% if pending_slips %}
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Slip ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Entry Fee</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Potential Payout</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Progress</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for slip in pending_slips[:10] %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            #{{ slip.slip_id }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            User {{ slip.user_id }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${{ "%.2f"|format(slip.entry_fee) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium">
                            ${{ "%.2f"|format(slip.potential_payout) }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ slip.settled_picks }}/{{ slip.total_picks }} settled
                            {% if slip.wins %}({{ slip.wins }} wins){% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="{{ url_for('fantasy_sports.view_slip', slip_id=slip.slip_id) }}" 
                               class="text-blue-600 hover:text-blue-900">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-8 text-center text-gray-500">
                No pending slips found
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Success/Error Messages -->
<div id="message-container" class="fixed top-4 right-4 z-50"></div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.tailwindcss.com"></script>
<script>
function showMessage(message, type = 'success') {
    const container = document.getElementById('message-container');
    const div = document.createElement('div');
    
    const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
    div.className = `${bgColor} text-white px-4 py-2 rounded shadow-lg mb-2`;
    div.textContent = message;
    
    container.appendChild(div);
    
    setTimeout(() => {
        div.remove();
    }, 5000);
}

document.getElementById('simulate-results-btn').addEventListener('click', async () => {
    if (!confirm('This will simulate results for all active props. Continue?')) {
        return;
    }
    
    const btn = document.getElementById('simulate-results-btn');
    btn.disabled = true;
    btn.textContent = 'Simulating...';
    
    try {
        const response = await fetch('/admin/api/simulate-results', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            showMessage(data.message, 'success');
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            showMessage(data.message, 'error');
        }
    } catch (error) {
        showMessage('Error simulating results', 'error');
    } finally {
        btn.disabled = false;
        btn.textContent = 'Simulate Results (Demo)';
    }
});
</script>
{% endblock %}