{% extends "fantasy_sports/sports/base_sport.html" %}

{% block sport_title %}MLB{% endblock %}
{% block sport_gradient %}from-red-50 to-blue-100{% endblock %}
{% block sport_header_bg %}bg-gradient-to-r from-red-600 to-blue-600{% endblock %}
{% block sport_icon_bg %}bg-white bg-opacity-20{% endblock %}
{% block sport_icon %}⚾{% endblock %}
{% block sport_name %}Major League Baseball{% endblock %}
{% block sport_subtitle %}Bet on MLB player props - Home runs, hits, RBIs and more{% endblock %}
{% block sport_slip_bg %}bg-red-600{% endblock %}
{% block sport_slip_hover %}bg-red-700{% endblock %}

{% block sport_prop_options %}
<option value="hits">Hits</option>
<option value="rbis">RBIs</option>
<option value="home_runs">Home Runs</option>
<option value="strikeouts">Strikeouts (Pitcher)</option>
<option value="earned_runs">Earned Runs (Pitcher)</option>
{% endblock %}

{% block sport_league_options %}
<option value="mlb">Major League Baseball</option>
<option value="ncaa_baseball">NCAA Baseball</option>
{% endblock %}

{% block content %}
{{ super() }}

<!-- MLB Specific Features -->
<div class="container mx-auto px-4 py-8">
    <!-- MLB Stats Bar -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4 flex items-center">
            <span class="text-2xl mr-2">📊</span>
            MLB Season Stats
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="text-center">
                <div class="text-2xl font-bold text-red-600" id="mlb-hr-leader">-</div>
                <div class="text-sm text-gray-600">HR Leader</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-blue-600" id="mlb-avg-leader">-</div>
                <div class="text-sm text-gray-600">Batting Avg Leader</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-green-600" id="mlb-era-leader">-</div>
                <div class="text-sm text-gray-600">ERA Leader</div>
            </div>
            <div class="text-center">
                <div class="text-2xl font-bold text-purple-600" id="mlb-so-leader">-</div>
                <div class="text-sm text-gray-600">K's Leader</div>
            </div>
        </div>
    </div>

    <!-- Featured MLB Players Showcase -->
    <div class="bg-gradient-to-r from-red-600 to-blue-600 rounded-lg shadow-lg p-6 mb-8 text-white">
        <h3 class="text-xl font-bold mb-4 flex items-center">
            <span class="text-2xl mr-2">⭐</span>
            Featured MLB Stars
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="featured-mlb-players">
            <!-- Featured players will be loaded here -->
        </div>
    </div>

    <!-- MLB Prop Categories -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4 flex items-center">
            <span class="text-2xl mr-2">🎯</span>
            Popular MLB Props
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
            <button class="prop-category-btn bg-red-50 hover:bg-red-100 border border-red-200 rounded-lg p-4 text-center transition-colors" data-prop="hits">
                <div class="text-2xl mb-2">🎯</div>
                <div class="font-semibold text-red-700">Hits</div>
                <div class="text-xs text-red-600">Player Hits O/U</div>
            </button>
            <button class="prop-category-btn bg-orange-50 hover:bg-orange-100 border border-orange-200 rounded-lg p-4 text-center transition-colors" data-prop="home_runs">
                <div class="text-2xl mb-2">⚾</div>
                <div class="font-semibold text-orange-700">Home Runs</div>
                <div class="text-xs text-orange-600">HR Props</div>
            </button>
            <button class="prop-category-btn bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg p-4 text-center transition-colors" data-prop="rbis">
                <div class="text-2xl mb-2">🏃</div>
                <div class="font-semibold text-blue-700">RBIs</div>
                <div class="text-xs text-blue-600">Runs Batted In</div>
            </button>
            <button class="prop-category-btn bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg p-4 text-center transition-colors" data-prop="strikeouts">
                <div class="text-2xl mb-2">📉</div>
                <div class="font-semibold text-green-700">Strikeouts</div>
                <div class="text-xs text-green-600">Pitcher K's</div>
            </button>
            <button class="prop-category-btn bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-lg p-4 text-center transition-colors" data-prop="earned_runs">
                <div class="text-2xl mb-2">🛡️</div>
                <div class="font-semibold text-purple-700">ERA</div>
                <div class="text-xs text-purple-600">Earned Runs</div>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block sport_scripts %}
<script>
// MLB-specific functionality
class MLBPage extends SportPage {
    constructor(config) {
        super(config);
        this.loadMLBSpecificData();
        this.bindMLBEvents();
    }
    
    async loadMLBSpecificData() {
        await this.loadFeaturedMLBPlayers();
        await this.loadMLBStats();
    }
    
    async loadFeaturedMLBPlayers() {
        // Featured MLB players with reliable ESPN photo URLs
        const featuredPlayers = [
            {
                first_name: 'Aaron',
                last_name: 'Judge',
                position: 'OF',
                team_short_name: 'NYY',
                player_id: 101,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/33192.png&w=350&h=254'
            },
            {
                first_name: 'Mike',
                last_name: 'Trout',
                position: 'OF',
                team_short_name: 'LAA',
                player_id: 102,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/30836.png&w=350&h=254'
            },
            {
                first_name: 'Mookie',
                last_name: 'Betts',
                position: 'OF',
                team_short_name: 'LAD',
                player_id: 103,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/31097.png&w=350&h=254'
            },
            {
                first_name: 'Ronald',
                last_name: 'Acuna Jr.',
                position: 'OF',
                team_short_name: 'ATL',
                player_id: 104,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/35004.png&w=350&h=254'
            },
            {
                first_name: 'Juan',
                last_name: 'Soto',
                position: 'OF',
                team_short_name: 'SD',
                player_id: 105,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/39572.png&w=350&h=254'
            },
            {
                first_name: 'Gerrit',
                last_name: 'Cole',
                position: 'P',
                team_short_name: 'NYY',
                player_id: 106,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/31095.png&w=350&h=254'
            },
            {
                first_name: 'Jacob',
                last_name: 'deGrom',
                position: 'P',
                team_short_name: 'TEX',
                player_id: 107,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/32796.png&w=350&h=254'
            },
            {
                first_name: 'Fernando',
                last_name: 'Tatis Jr.',
                position: 'SS',
                team_short_name: 'SD',
                player_id: 108,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/mlb/players/full/39553.png&w=350&h=254'
            }
        ];
        
        try {
            const container = document.getElementById('featured-mlb-players');
            container.innerHTML = '';
            
            featuredPlayers.slice(0, 8).forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = 'bg-white bg-opacity-20 rounded-lg p-4 text-center hover:bg-opacity-30 transition-colors cursor-pointer';
                playerCard.innerHTML = `
                    <div class="w-16 h-16 mx-auto mb-3 rounded-full overflow-hidden bg-white">
                        <img src="${player.photo_url}" alt="${player.first_name} ${player.last_name}" 
                             class="w-full h-full object-cover"
                             onerror="this.src='https://via.placeholder.com/64x64/dc2626/ffffff?text=${player.first_name[0]}${player.last_name[0]}'">
                    </div>
                    <div class="font-semibold text-sm">${player.first_name} ${player.last_name}</div>
                    <div class="text-xs opacity-75 mb-2">${player.team_short_name || 'MLB'} - ${player.position || 'Player'}</div>
                    <div class="text-lg">${player.position === 'P' ? '⚾' : '🏏'}</div>
                `;
                
                playerCard.addEventListener('click', () => {
                    // Filter props by this player
                    this.filterPropsByPlayer(player.player_id);
                });
                
                container.appendChild(playerCard);
            });
            
        } catch (error) {
            console.error('Error loading featured MLB players:', error);
            const container = document.getElementById('featured-mlb-players');
            container.innerHTML = '<div class="col-span-full text-center py-4 text-white opacity-75">Unable to load players</div>';
        }
    }
    
    async loadMLBStats() {
        // Simulate MLB stats (in production, you'd fetch from MLB API)
        const stats = {
            hr_leader: "Judge (58)",
            avg_leader: "Witt Jr. (.332)",
            era_leader: "Wheeler (2.57)",
            so_leader: "Cole (222)"
        };
        
        document.getElementById('mlb-hr-leader').textContent = stats.hr_leader;
        document.getElementById('mlb-avg-leader').textContent = stats.avg_leader;
        document.getElementById('mlb-era-leader').textContent = stats.era_leader;
        document.getElementById('mlb-so-leader').textContent = stats.so_leader;
    }
    
    bindMLBEvents() {
        // Prop category filter buttons
        document.querySelectorAll('.prop-category-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const propType = e.currentTarget.dataset.prop;
                this.filterPropsByType(propType);
                
                // Switch to props tab
                this.switchTab('props');
                
                // Highlight selected category
                document.querySelectorAll('.prop-category-btn').forEach(b => b.classList.remove('ring-2', 'ring-blue-500'));
                e.currentTarget.classList.add('ring-2', 'ring-blue-500');
            });
        });
    }
    
    async filterPropsByType(propType) {
        try {
            // Map prop type to filter
            const propTypeMap = {
                'hits': 'Hits',
                'home_runs': 'Home Runs',
                'rbis': 'RBIs',
                'strikeouts': 'Strikeouts',
                'earned_runs': 'Earned Runs'
            };
            
            const response = await fetch(`/fantasy-sports/api/props?sport_id=${this.sportId}&prop_type=${propTypeMap[propType]}&limit=50`);
            const data = await response.json();
            
            if (data.success) {
                this.renderProps(data.props);
            }
        } catch (error) {
            console.error('Error filtering props:', error);
        }
    }
    
    async filterPropsByPlayer(playerId) {
        try {
            const response = await fetch(`/fantasy-sports/api/player-props?player_id=${playerId}`);
            const data = await response.json();
            
            if (data.success) {
                this.renderProps(data.props);
                this.switchTab('props');
            }
        } catch (error) {
            console.error('Error filtering props by player:', error);
        }
    }
}

// Override the SportPage initialization for MLB
document.addEventListener('DOMContentLoaded', () => {
    new MLBPage(sportConfig);
});
</script>
{% endblock %}