{% extends "fantasy_sports/sports/base_sport.html" %}

{% block sport_title %}NBA{% endblock %}
{% block sport_gradient %}from-orange-50 to-red-100{% endblock %}
{% block sport_header_bg %}bg-gradient-to-r from-orange-600 to-red-600{% endblock %}
{% block sport_icon_bg %}bg-white bg-opacity-20{% endblock %}
{% block sport_icon %}üèÄ{% endblock %}
{% block sport_name %}National Basketball Association{% endblock %}
{% block sport_subtitle %}Bet on NBA player props - Points, rebounds, assists and more{% endblock %}
{% block sport_slip_bg %}bg-orange-600{% endblock %}
{% block sport_slip_hover %}bg-orange-700{% endblock %}

{% block sport_prop_options %}
<option value="points">Points</option>
<option value="rebounds">Rebounds</option>
<option value="assists">Assists</option>
<option value="steals">Steals</option>
<option value="blocks">Blocks</option>
<option value="3_pointers_made">3-Pointers Made</option>
{% endblock %}

{% block sport_league_options %}
<option value="nba">National Basketball Association</option>
<option value="ncaa_basketball">NCAA Basketball</option>
{% endblock %}

{% block content %}
{{ super() }}

<!-- NBA Specific Features -->
<div class="container mx-auto px-4 py-8">
    <!-- NBA Season Info -->
    <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-lg shadow-lg p-6 mb-8 text-white">
        <div class="flex justify-between items-center">
            <div>
                <h3 class="text-xl font-bold mb-2">2024-25 NBA Season</h3>
                <p class="opacity-90">Regular season in progress ‚Ä¢ 82 games per team</p>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold" id="nba-games-today">-</div>
                <div class="text-sm opacity-75">Games Today</div>
            </div>
        </div>
    </div>

    <!-- NBA Stat Categories -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4 flex items-center">
            <span class="text-2xl mr-2">üìä</span>
            Player Stats Categories
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <button class="stat-category-btn bg-red-50 hover:bg-red-100 border border-red-200 rounded-lg p-4 text-center transition-colors" data-stat="points">
                <div class="text-2xl mb-2">üèÄ</div>
                <div class="font-semibold text-red-700">Points</div>
                <div class="text-xs text-red-600">Scoring</div>
            </button>
            <button class="stat-category-btn bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg p-4 text-center transition-colors" data-stat="rebounds">
                <div class="text-2xl mb-2">ü¶ò</div>
                <div class="font-semibold text-blue-700">Rebounds</div>
                <div class="text-xs text-blue-600">Boards</div>
            </button>
            <button class="stat-category-btn bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg p-4 text-center transition-colors" data-stat="assists">
                <div class="text-2xl mb-2">ü§ù</div>
                <div class="font-semibold text-green-700">Assists</div>
                <div class="text-xs text-green-600">Dimes</div>
            </button>
            <button class="stat-category-btn bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-lg p-4 text-center transition-colors" data-stat="steals">
                <div class="text-2xl mb-2">ü•∑</div>
                <div class="font-semibold text-purple-700">Steals</div>
                <div class="text-xs text-purple-600">Takeaways</div>
            </button>
            <button class="stat-category-btn bg-indigo-50 hover:bg-indigo-100 border border-indigo-200 rounded-lg p-4 text-center transition-colors" data-stat="blocks">
                <div class="text-2xl mb-2">üõ°Ô∏è</div>
                <div class="font-semibold text-indigo-700">Blocks</div>
                <div class="text-xs text-indigo-600">Swats</div>
            </button>
            <button class="stat-category-btn bg-orange-50 hover:bg-orange-100 border border-orange-200 rounded-lg p-4 text-center transition-colors" data-stat="3_pointers">
                <div class="text-2xl mb-2">üéØ</div>
                <div class="font-semibold text-orange-700">3-Pointers</div>
                <div class="text-xs text-orange-600">Threes</div>
            </button>
        </div>
    </div>

    <!-- NBA Star Players Showcase -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4 flex items-center">
            <span class="text-2xl mr-2">‚≠ê</span>
            NBA Superstars
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="nba-superstars">
            <!-- NBA superstars will be loaded here -->
            <div class="text-center py-8 col-span-full text-gray-500">Loading NBA superstars...</div>
        </div>
    </div>

    <!-- Popular Prop Combos -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-lg p-6 mb-8 text-white">
        <h3 class="text-xl font-bold mb-4 flex items-center">
            <span class="text-2xl mr-2">üî•</span>
            Popular Prop Combinations
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center hover:bg-opacity-30 transition-colors cursor-pointer combo-btn" data-combo="triple_double">
                <div class="text-2xl mb-2">üéØ</div>
                <div class="font-semibold">Triple-Double Watch</div>
                <div class="text-sm opacity-75">10+ Pts, Reb, Ast</div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center hover:bg-opacity-30 transition-colors cursor-pointer combo-btn" data-combo="scorer">
                <div class="text-2xl mb-2">üî•</div>
                <div class="font-semibold">High Scorers</div>
                <div class="text-sm opacity-75">25+ Points</div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-lg p-4 text-center hover:bg-opacity-30 transition-colors cursor-pointer combo-btn" data-combo="playmaker">
                <div class="text-2xl mb-2">üé≠</div>
                <div class="font-semibold">Playmakers</div>
                <div class="text-sm opacity-75">8+ Assists</div>
            </div>
        </div>
    </div>

    <!-- NBA Matchup Highlights -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4 flex items-center">
            <span class="text-2xl mr-2">‚ö°</span>
            Matchup Highlights
        </h3>
        <div id="nba-matchups" class="space-y-4">
            <!-- NBA matchups will be loaded here -->
            <div class="text-center py-4 text-gray-500">Loading matchups...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block sport_scripts %}
<script>
// NBA-specific functionality
class NBAPage extends SportPage {
    constructor(config) {
        super(config);
        this.loadNBASpecificData();
        this.bindNBAEvents();
    }
    
    async loadNBASpecificData() {
        await this.loadNBASuperstars();
        await this.loadNBAMatchups();
        await this.loadNBAStats();
    }
    
    async loadNBASuperstars() {
        // Featured NBA superstars with reliable ESPN photo URLs
        const nbaSuperstars = [
            {
                first_name: 'LeBron',
                last_name: 'James',
                position: 'SF',
                team_short_name: 'LAL',
                player_id: 201,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/1966.png&w=350&h=254'
            },
            {
                first_name: 'Stephen',
                last_name: 'Curry',
                position: 'PG',
                team_short_name: 'GSW',
                player_id: 202,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/3975.png&w=350&h=254'
            },
            {
                first_name: 'Nikola',
                last_name: 'Jokic',
                position: 'C',
                team_short_name: 'DEN',
                player_id: 203,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/3112335.png&w=350&h=254'
            },
            {
                first_name: 'Luka',
                last_name: 'Doncic',
                position: 'PG',
                team_short_name: 'DAL',
                player_id: 204,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/3945274.png&w=350&h=254'
            },
            {
                first_name: 'Giannis',
                last_name: 'Antetokounmpo',
                position: 'PF',
                team_short_name: 'MIL',
                player_id: 205,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/3032977.png&w=350&h=254'
            },
            {
                first_name: 'Joel',
                last_name: 'Embiid',
                position: 'C',
                team_short_name: 'PHI',
                player_id: 206,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/3059318.png&w=350&h=254'
            },
            {
                first_name: 'Jayson',
                last_name: 'Tatum',
                position: 'SF',
                team_short_name: 'BOS',
                player_id: 207,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/4065648.png&w=350&h=254'
            },
            {
                first_name: 'Kevin',
                last_name: 'Durant',
                position: 'SF',
                team_short_name: 'PHX',
                player_id: 208,
                photo_url: 'https://a.espncdn.com/combiner/i?img=/i/headshots/nba/players/full/3202.png&w=350&h=254'
            }
        ];
        
        try {
            const container = document.getElementById('nba-superstars');
            container.innerHTML = '';
            
            nbaSuperstars.slice(0, 8).forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = 'bg-gradient-to-br from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4 text-center hover:shadow-md transition-shadow cursor-pointer';
                playerCard.innerHTML = `
                    <div class="w-16 h-16 mx-auto mb-3 rounded-full overflow-hidden bg-gray-200">
                        <img src="${player.photo_url}" 
                             alt="${player.first_name} ${player.last_name}" 
                             class="w-full h-full object-cover"
                             onerror="this.src='https://via.placeholder.com/64x64/f97316/ffffff?text=${player.first_name[0]}${player.last_name[0]}'">
                    </div>
                    <div class="font-semibold text-gray-900">${player.first_name} ${player.last_name}</div>
                    <div class="text-xs text-gray-600 mb-2">${player.team_short_name || 'NBA'} - ${player.position || 'Player'}</div>
                    <div class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">View Props</div>
                `;
                
                playerCard.addEventListener('click', () => {
                    this.filterPropsByPlayer(player.player_id);
                });
                
                container.appendChild(playerCard);
            });
            
        } catch (error) {
            console.error('Error loading NBA superstars:', error);
            const container = document.getElementById('nba-superstars');
            container.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">Unable to load players</div>';
        }
    }
    
    async loadNBAMatchups() {
        try {
            const response = await fetch('/fantasy-sports/api/games');
            const data = await response.json();
            
            if (data.success) {
                // Filter for basketball games
                const nbaGames = data.games.filter(g => g.sport_name === 'Basketball').slice(0, 3);
                
                const container = document.getElementById('nba-matchups');
                container.innerHTML = '';
                
                if (nbaGames.length === 0) {
                    container.innerHTML = '<div class="text-center py-4 text-gray-500">No NBA games scheduled</div>';
                    return;
                }
                
                nbaGames.forEach(game => {
                    const gameDate = new Date(game.game_date);
                    const matchupCard = document.createElement('div');
                    matchupCard.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer';
                    matchupCard.innerHTML = `
                        <div class="flex items-center space-x-4">
                            <div class="text-center">
                                <div class="font-semibold">${game.away_team_short}</div>
                                <div class="text-xs text-gray-500">${game.away_team_city}</div>
                            </div>
                            <div class="text-gray-400">@</div>
                            <div class="text-center">
                                <div class="font-semibold">${game.home_team_short}</div>
                                <div class="text-xs text-gray-500">${game.home_team_city}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium">${gameDate.toLocaleDateString()}</div>
                            <div class="text-xs text-gray-500">${gameDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        </div>
                        <div class="bg-orange-100 text-orange-700 px-3 py-1 rounded text-xs font-medium">
                            View Props
                        </div>
                    `;
                    
                    matchupCard.addEventListener('click', () => {
                        this.filterPropsForGame(game.game_id);
                    });
                    
                    container.appendChild(matchupCard);
                });
            }
        } catch (error) {
            console.error('Error loading NBA matchups:', error);
        }
    }
    
    async loadNBAStats() {
        try {
            // Count today's NBA games
            const response = await fetch('/fantasy-sports/api/games');
            const data = await response.json();
            
            if (data.success) {
                const today = new Date().toDateString();
                const todayGames = data.games.filter(g => {
                    return g.sport_name === 'Basketball' && 
                           new Date(g.game_date).toDateString() === today;
                });
                
                document.getElementById('nba-games-today').textContent = todayGames.length;
            }
        } catch (error) {
            console.error('Error loading NBA stats:', error);
            document.getElementById('nba-games-today').textContent = '0';
        }
    }
    
    bindNBAEvents() {
        // Stat category buttons
        document.querySelectorAll('.stat-category-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const stat = e.currentTarget.dataset.stat;
                this.filterPropsByStat(stat);
                
                // Switch to props tab
                this.switchTab('props');
                
                // Highlight selected category
                document.querySelectorAll('.stat-category-btn').forEach(b => b.classList.remove('ring-2', 'ring-orange-500'));
                e.currentTarget.classList.add('ring-2', 'ring-orange-500');
            });
        });
        
        // Combo buttons
        document.querySelectorAll('.combo-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const combo = e.currentTarget.dataset.combo;
                this.filterPropsByCombo(combo);
                
                // Switch to props tab
                this.switchTab('props');
            });
        });
    }
    
    async filterPropsByStat(stat) {
        try {
            // Map stat to prop type
            const statMap = {
                'points': 'Points',
                'rebounds': 'Rebounds',
                'assists': 'Assists',
                'steals': 'Steals',
                'blocks': 'Blocks',
                '3_pointers': '3-Pointers Made'
            };
            
            const response = await fetch(`/fantasy-sports/api/props?sport_id=${this.sportId}&prop_type=${statMap[stat]}&limit=50`);
            const data = await response.json();
            
            if (data.success) {
                this.renderProps(data.props);
            }
        } catch (error) {
            console.error('Error filtering props by stat:', error);
        }
    }
    
    async filterPropsByCombo(combo) {
        try {
            let filterCriteria = {};
            
            switch(combo) {
                case 'triple_double':
                    // Show points, rebounds, assists props
                    filterCriteria.prop_types = ['Points', 'Rebounds', 'Assists'];
                    break;
                case 'scorer':
                    // Show points props with high lines
                    filterCriteria.prop_types = ['Points'];
                    filterCriteria.min_line = 25;
                    break;
                case 'playmaker':
                    // Show assists props
                    filterCriteria.prop_types = ['Assists'];
                    break;
            }
            
            const response = await fetch(`/fantasy-sports/api/props?sport_id=${this.sportId}&limit=30`);
            const data = await response.json();
            
            if (data.success) {
                let filteredProps = data.props;
                
                // Apply combo-specific filters
                if (filterCriteria.prop_types) {
                    filteredProps = filteredProps.filter(prop => 
                        filterCriteria.prop_types.includes(prop.prop_type_name)
                    );
                }
                
                if (filterCriteria.min_line) {
                    filteredProps = filteredProps.filter(prop => 
                        parseFloat(prop.line_value) >= filterCriteria.min_line
                    );
                }
                
                this.renderProps(filteredProps);
            }
        } catch (error) {
            console.error('Error filtering props by combo:', error);
        }
    }
    
    async filterPropsByPlayer(playerId) {
        try {
            const response = await fetch(`/fantasy-sports/api/player-props?player_id=${playerId}`);
            const data = await response.json();
            
            if (data.success) {
                this.renderProps(data.props);
                this.switchTab('props');
            }
        } catch (error) {
            console.error('Error filtering props by player:', error);
        }
    }
    
    async filterPropsForGame(gameId) {
        try {
            const response = await fetch(`/fantasy-sports/api/props?game_id=${gameId}`);
            const data = await response.json();
            
            if (data.success) {
                this.renderProps(data.props);
                this.switchTab('props');
            }
        } catch (error) {
            console.error('Error filtering props for game:', error);
        }
    }
}

// Override the SportPage initialization for NBA
document.addEventListener('DOMContentLoaded', () => {
    new NBAPage(sportConfig);
});
</script>
{% endblock %}